<wxs src="./index.wxs" module="patchTools" />

<view class="container">
  <!-- <view class="header">
    <text class="title">è´´ä»¶ç®¡ç†ç³»ç»Ÿ</text>
    <text class="description">ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ‰‹åŠ¿æ“ä½œ</text>
  </view> -->
  
  <view class="main-content">
    <view class="workspace">
      <view class="workspace-header">
        <text class="workspace-title">å·¥ä½œåŒº</text>
        <view class="workspace-controls">
          <text class="zoom-level">ç¼©æ”¾: {{patchTools.formatZoomLevel(zoomLevel)}}</text>
          <button 
            class="toggle-guide-btn {{showAreaGuides ? 'active' : ''}}" 
            bindtap="toggleAreaGuides"
            size="mini"
          >
            {{patchTools.getAreaGuideButtonText(showAreaGuides)}}
          </button>
        </view>
      </view>

      <!-- ä¿®æ”¹åº•ä»¶å®¹å™¨ï¼Œæ·»åŠ å•æŒ‡ç§»åŠ¨æŸ¥çœ‹åŠŸèƒ½ -->
      <view 
        class="base-component-container" 
        id="base-container"
        bindtouchstart="onContainerTouchStart"
        bindtouchmove="onContainerTouchMove"
        bindtouchend="onContainerTouchEnd"
      >
        <view 
          class="base-component" 
          style="{{patchTools.getWorkspaceTransform(workspaceOffsetX, workspaceOffsetY, zoomLevel, transformOriginX, transformOriginY)}}"
        >
          <!-- å¯ç§»åŠ¨åŒºåŸŸ -->
          <view 
            wx:if="{{showAreaGuides}}"
            class="movable-area" 
            style="{{patchTools.getMovableAreaStyle(movableArea)}}"
          ></view>
          
          <!-- ä¸å¯ç§»åŠ¨åŒºåŸŸ -->
          <view 
            wx:if="{{showAreaGuides}}"
            wx:for="{{nonMovableAreas}}" 
            wx:key="index" 
            class="non-movable-area" 
            style="{{patchTools.getNonMovableAreaStyle(item)}}"
          ></view>
          
          <!-- è´´ä»¶ -->
          <view 
            wx:for="{{patches}}" 
            wx:key="index" 
            class="patch {{item.selected ? 'selected' : ''}}" 
            data-index="{{index}}"
            style="{{patchTools.getPatchStyle(item)}}"
            bindtap="onPatchTap"
            catchtouchstart="onPatchTouchStart"
            catchtouchmove="onPatchTouchMove"
            catchtouchend="onPatchTouchEnd"
          >
            <text class="patch-text">{{patchTools.formatPatchNumber(index)}}</text>
            
            <!-- æ—‹è½¬å›¾æ ‡ï¼ˆåªåœ¨é€‰ä¸­æ—¶æ˜¾ç¤ºï¼‰ -->
            <view 
              wx:if="{{item.selected}}" 
              class="rotate-handle" 
              data-index="{{index}}"
              catchtouchstart="onRotateHandleTouchStart"
              catchtouchmove="onRotateHandleTouchMove"
              catchtouchend="onRotateHandleTouchEnd"
            >
              <text class="rotate-icon">â†»</text>
            </view>
          </view>
        </view>
        <view class="zoom-hint {{showZoomHint ? 'show' : ''}}">åŒæŒ‡æ‰‹åŠ¿ç¼©æ”¾</view>
        
        <!-- ç”¨äºç”Ÿæˆå¿«ç…§çš„éšè—Canvas -->
        <canvas 
          type="2d" 
          id="snapshot-canvas"
          style="position: absolute; left: -9999px; top: -9999px; width: 1px; height: 1px;"
        ></canvas>
      </view>
    </view>
    
    <!-- ç¡®è®¤æŒ‰é’® -->
    <view class="confirm-section">
      <button 
        class="confirm-btn {{patchTools.getConfirmButtonClass(allValid, generating)}}" 
        bindtap="generateSnapshot"
        disabled="{{!allValid || generating}}"
      >
        {{patchTools.getConfirmButtonText(allValid, generating)}}
      </button>
    </view>
    
    <view class="controls">
      <view class="control-group">
        <view class="control-title">
          <text class="icon">+</text>
          <text>æ·»åŠ è´´ä»¶</text>
        </view>
        <view class="button-group">
          <button class="btn-add" bindtap="addPatch" data-size="small">å°è´´ä»¶</button>
          <button class="btn-add" bindtap="addPatch" data-size="medium">ä¸­è´´ä»¶</button>
        </view>
      </view>
      
      <view class="status">
        <view class="control-title">
          <text class="icon">â„¹</text>
          <text>çŠ¶æ€ä¿¡æ¯</text>
        </view>
        <view class="status-item">
          <text>å½“å‰é€‰ä¸­:</text>
          <text>{{selectedPatchIndex !== null ? patchTools.formatPatchNumber(selectedPatchIndex) : 'æ— '}}</text>
        </view>
        <view class="status-item">
          <text>è´´ä»¶æ•°é‡:</text>
          <text>{{patches.length}}</text>
        </view>
        <view class="status-item">
          <text>çŠ¶æ€:</text>
          <text style="color: {{allValid ? '#2ecc71' : '#e74c3c'}}">{{allValid ? 'ç¬¦åˆè¦æ±‚' : 'ä¸ç¬¦åˆè¦æ±‚'}}</text>
        </view>
      </view>
      
      <!-- <view class="instructions">
        <view class="control-title">
          <text class="icon">ğŸ‘†</text>
          <text>æ‰‹åŠ¿æ“ä½œ</text>
        </view>
        <view class="gesture-hints">
          <view class="gesture">
            <view class="gesture-icon">ğŸ‘†</view>
            <text>å•æŒ‡æ‹–åŠ¨è´´ä»¶</text>
          </view>
          <view class="gesture">
            <view class="gesture-icon">â†»</view>
            <text>æ‹–åŠ¨æ—‹è½¬å›¾æ ‡æ—‹è½¬</text>
          </view>
          <view class="gesture">
            <view class="gesture-icon">ğŸ¤</view>
            <text>åŒæŒ‡ç¼©æ”¾å·¥ä½œåŒº</text>
          </view>
        </view>
      </view> -->
    </view>
  </view>
</view>